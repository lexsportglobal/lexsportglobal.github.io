<!DOCTYPE HTML>
<html>
<head>
    <title>Data Scouting - LEX SPORT GLOBAL</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <style>
        /* --- OPTIMISATION GENERALE --- */
        .image.main img { max-height: 400px; object-fit: cover; border-bottom: 3px solid #C5A05F; }
        .bilingual-grid { display: flex; gap: 40px; margin-top: 30px; }
        .lang-box { flex: 1; padding: 20px; line-height: 1.8; }
        @media screen and (max-width: 736px) { .bilingual-grid { flex-direction: column; } }

        /* --- FILTRES --- */
        .filter-bar {
            text-align: center;
            margin: 40px 0;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .filter-btn {
            background: transparent !important;
            color: #D4AF37 !important;
            border: 1px solid #D4AF37 !important;
            padding: 8px 20px !important;
            font-size: 11px !important;
            letter-spacing: 1px;
            cursor: pointer;
            transition: 0.3s;
        }
        .filter-btn:hover, .filter-btn.active {
            background: #D4AF37 !important;
            color: #000 !important;
        }

        /* --- GRILLE & CARTES --- */
        #players-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            padding: 20px;
            background-color: #0f0f0f;
        }
        .player-card {
            background: linear-gradient(145deg, #232323, #1a1a1a);
            border: 1px solid #D4AF37;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            position: relative;
            transition: 0.3s;
        }
        .player-card:hover { transform: translateY(-10px); box-shadow: 0 10px 20px rgba(212, 175, 55, 0.3); }
        .player-card img { width: 120px; height: 120px; border-radius: 50%; border: 3px solid #D4AF37; object-fit: cover; margin-bottom: 15px; }
        
        /* --- BADGES --- */
        .player-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 9px;
            font-weight: 900;
            text-transform: uppercase;
        }
        .status-pro { background: #D4AF37; color: #000; }
        .status-free { background: #000; color: #D4AF37; border: 1px solid #D4AF37; }
        .status-amateur { background: #444; color: #fff; }

        /* --- MODALE --- */
        .modal { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px); }
        .modal-content { background: #1a1a1a; margin: 5% auto; padding: 30px; border: 1px solid #D4AF37; width: 90%; max-width: 500px; border-radius: 15px; color: white; position: relative; }
        .close-modal { position: absolute; right: 20px; top: 10px; color: #D4AF37; font-size: 35px; cursor: pointer; }
    </style>
</head>
<body class="is-preload">
    <div id="wrapper">
        <div id="main">
            <div class="inner">
                <header id="header">
                    <a href="index.html" class="logo">
                        <img src="images/logo_final.jpg" alt="Logo" style="height: 30px; vertical-align: middle;" />
                        <strong>LEX SPORT GLOBAL</strong> | Performance & Analytics
                    </a>
                </header>

                <section>
                    <header class="main"><h1>Data Scouting</h1></header>
                    <span class="image main"><img src="images/scouting_data.jpg" alt="" /></span>

                    <div class="filter-bar">
                        <button class="filter-btn" onclick="filterPlayers('all')">TOUS</button>
                        <button class="filter-btn" onclick="filterPlayers('pro')">PROS</button>
                        <button class="filter-btn" onclick="filterPlayers('amateur')">AMATEURS</button>
                        <button class="filter-btn" onclick="filterPlayers('free agent')">FREE AGENTS</button>
                    </div>

                    <div id="players-container"></div>
                </section>
            </div>
        </div>
    </div>

    <div id="playerModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div id="modalDetails"></div>
        </div>
    </div>

    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let allPlayers = [];
            const supabaseUrl = 'https://kjhrikutzxixmvmhbjqk.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtqaHJpa3V0enhpeG12bWhianFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNzg4NzQsImV4cCI6MjA4Njg1NDg3NH0.df9_4U08BN-NPNaXYXsyWTkSZqoNT7UtF_Iz8lx6HZo';

            async function fetchPlayers() {
                try {
                    const response = await fetch(`${supabaseUrl}/rest/v1/players?select=*`, {
                        headers: { 'apikey': supabaseKey, 'Authorization': `Bearer ${supabaseKey}` }
                    });
                    allPlayers = await response.json();
                    displayPlayers(allPlayers);
                } catch (error) { console.error("Erreur:", error); }
            }

            window.displayPlayers = function(players) {
                const container = document.getElementById('players-container');
                container.innerHTML = '';
                players.forEach((player, index) => {
                    let s = (player.status || 'Amateur').toLowerCase();
                    let badgeClass = s === 'pro' ? 'status-pro' : (s.includes('free') ? 'status-free' : 'status-amateur');
                    
                    container.innerHTML += `
                        <div class="player-card">
                            <div class="player-badge ${badgeClass}">${player.status || 'Amateur'}</div>
                            <img src="${player.photo_url || 'https://via.placeholder.com/150'}" alt="">
                            <h3>${player.full_name}</h3>
                            <p>üìç ${player.position || 'N/A'}</p>
                            <button onclick="showDetails(${index}, '${player.full_name}')" style="width:100%; background:#D4AF37 !important; color:#000 !important; font-weight:bold; border:none; height:40px; border-radius:5px; cursor:pointer;">VIEW PROFILE</button>
                        </div>`;
                });
            }

            window.filterPlayers = function(category) {
                const filtered = (category === 'all') 
                    ? allPlayers 
                    : allPlayers.filter(p => (p.status || '').toLowerCase().includes(category.toLowerCase()));
                displayPlayers(filtered);
            };

            window.showDetails = function(index, fullName) {
                // On retrouve le joueur par son nom pour √©viter les erreurs d'index apr√®s filtrage
                const player = allPlayers.find(p => p.full_name === fullName);
                const details = document.getElementById("modalDetails");
                details.innerHTML = `
                    <h2 style="color:#D4AF37;">${player.full_name}</h2>
                    <p>${player.position} | ${player.nationality}</p>
                    <hr style="border-color:#333;">
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; font-size:13px;">
                        <div><label style="color:#D4AF37; display:block; font-size:10px;">PIED</label>${player.preferred_foot || 'N/A'}</div>
                        <div><label style="color:#D4AF37; display:block; font-size:10px;">VALEUR</label>${player.market_value || 'N/A'}</div>
                    </div>
                    <div style="margin-top:20px; padding:10px; background:#222; border-left:3px solid #D4AF37; font-style:italic;">
                        "${player.scout_comment || 'Analyse en cours...'}"
                    </div>`;
                document.getElementById("playerModal").style.display = "block";
            };

            const modal = document.getElementById("playerModal");
            document.querySelector(".close-modal").onclick = () => modal.style.display = "none";
            window.onclick = (e) => { if(e.target == modal) modal.style.display = "none"; };

            fetchPlayers();
        });
    </script>
</body>
</html>
